# Abaqus 作业监控脚本 需求


一个用于监控 Abaqus 仿真计算作业的 Python 脚本，支持通过飞书消息推送机器人Webhook实时推送作业状态通知，并记录作业日志到飞书的多维表格。多维表格根据作业的sta文件来记录状态，项目代码需要具有可维护性，方便后续功能添加

## ✨ 需要实现的功能

- 🔍 **自动检测作业** - 通过监控 `.lck` 文件自动检测作业的开始和结束
- 📊 **进度追踪** - 实时解析 `.sta` 文件，获取 Step、Increment、Total Time 以及最后一行计算状态信息等进度信息
- 📱 **飞书机器人通知** - 作业开始/结束/异常时自动推送 Markdown 格式通知
- 📝 **飞书多维表格日志记录** - 自动记录作业信息到飞书多维 文件，支持更新
- ⚠️ **异常检测** - 检测孤立 `.lck` 文件（进程已停止但文件未删除）
- 🔄 **进程检测** - 通过检测 Abaqus 求解器进程判断作业状态
- 📁 **多目录监控** - 支持同时监控多个工作目录

## 📋 系统要求

- Python 3.9+
- Windows 操作系统

## ⚙️ 配置说明

### 基本配置

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `WEBHOOK_URL` | - |机器人 Webhook 地址 |
| `WATCH_DIRS` | - | 监控目录列表 |
| `POLL_INTERVAL` | 5 | 轮询间隔（秒） |
| `VERBOSE` | True | 是否启用详细日志 |

### 进度通知配置

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `PROGRESS_NOTIFY_INTERVAL` | 3600 | 进度推送间隔（秒），设为 0 禁用 |
| `SHOW_PROGRESS_IN_CONSOLE` | False | 是否在控制台显示实时进度 |

### 进程检测配置

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `ENABLE_PROCESS_DETECTION` | True | 是否启用进程检测 |
| `ABAQUS_PROCESSES` | [...] | Abaqus 求解器进程名列表 |
| `LCK_GRACE_PERIOD` | 60 | `.lck` 文件宽限期（秒） |


**文件名模板支持：**
- `{folder}` - 监控目录的文件夹名
- `%Y%m%d` - 日期格式化（年月日）
- 示例：`Jobs-TES-2024-3-20260112.csv`

## 📊 记录字段

| 字段 | 说明 |
|------|------|
| 作业名称 | Abaqus 作业名 |
| 工作目录 | 作业所在目录 |
| 计算机 | 运行计算的主机名 |
| 开始时间 | 作业开始时间 |
| 结束时间 | 作业结束时间（仅完成时记录） |
| 耗时 | 计算耗时 |
| 状态 | 运行中/成功/失败/异常终止，根据.sta文件最后一排信息判断 |
| 计算结果 | 详细状态描述 |
| ODB大小(MB) | ODB 文件大小 |
| TOTALTIME/FREQ | .sta 文件中的总时间/频率 |

## 🔔 通知示例

### 作业开始
```
🚀 Abaqus 计算开始
作业名称: Job-1
工作目录: C:/Abaqus/Jobs
开始时间: 2026-01-12 10:00:00
```

### 进度更新
```
📊 Abaqus 计算进度
作业名称: Job-1
已运行: 1小时 30分钟 0秒
当前进度: Step: 1 | Increment: 45 | Total Time: 0.575
```

### 作业完成
```
✅ Abaqus 计算完成
作业名称: Job-1
计算结果: 计算成功完成 - 收敛正常，结果可用
计算耗时: 2小时 15分钟 30秒
```

